<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
	<meta http-equiv='Content-Type' content='text/html; charset=utf-8' />
	<meta http-equiv='Content-Script-Type' content='text/javascript; charset=utf-8' />
	<meta http-equiv='Content-Style-Type' content='text/css; charset=utf-8' />
	<meta content='y@s' name='author'/>
	<meta content='iTunes + YouTube = iTube' name='description'/>
	<meta content='iTunes,YouTube' name='keyword'/>
	<title>iTube β</title>
	<link rel='stylesheet' href='./css/common.css' media='screen' type='text/css' charset='utf-8' />
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.js" type="text/javascript"></script>
	<script src='./js/common.js' type='text/javascript'></script>
	<script src='./js/itube.js' type='text/javascript'></script>
	<script src="../jquery/lib/jquery.jsonToString.js" type="text/javascript"></script>
	<script src="../jquery/lib/jquery.itunes.feed.js" type="text/javascript"></script>
	<script src='http://www.google.com/jsapi' type='text/javascript'></script>
	<script type='text/javascript'>google.load('feeds','1',{'nocss' : true})</script>
<script type='text/javascript'>
(function($){
$.extend($.iTunes,{
dataKey:'itunes',
//category exchanger
cex: {
	'Top Albums': 'トップアルバム',
	'Top Songs': 'トップソング',
	'New Releases': '最新リリース',
	'Just Added': '新規追加',
	'Featured Albums': '特集 & 限定'
},
//genre exchanger
gex: {
	0:'All',
	6:'Country',
	7:'Electronic',
	10:'Folk',
	11:'Jazz',
	13:'New Age',
	14:'Pop',
	15:'R&B/Soul',
	17:'Dance',
	18:'HipHop/Rap',
	19:'World',
	21:'Rock',
	23:'Vocal',
	24:'Reggae',
	27:'J-Pop'
},
gFeed:function( params, callback ){
	
	callback = $.isFunction(params) ? params : callback || function(){};
	params = params || {};
	
	var prms = $.extend({
		category:'topalbms',
		sf:143462,
		limit:10,
		genre:0,
		explicit:true
	}, params);
	
	var url = 'http://ax.itunes.apple.com/WebObjects/MZStore.woa/wpa/MRSS/' + 
		prms.category.toLowerCase() +
		'/sf=' + prms.sf +
		'/limit=' + prms.limit +
		'/genre=' + prms.genre +
		'/explicit=' + prms.explicit + '/rss.xml';
	
	var feed = new google.feeds.Feed(url);
	
	feed.setNumEntries(-1);
	feed.setResultFormat(google.feeds.Feed.MIXED_FORMAT);
	feed.load(function(result){
		if (!result.error) {
			callback.call(this, result.feed);
		}
	});
}
});

$.makeiTunesRankingList = function(category, genre){
	$('#itunes-feed-list').slideUp(function(){
		$.iTunes.gFeed({
			'category':category,
			sf: 143462,
			limit: 10,
			'genre':genre
		}, function(feed){
			
			var
			entries = feed.entries,
			$wrap = $('<div>').append('<h4 id=\'itunes-feed-title\'>' + feed.title + '</h4>');
			
			function getNodes (xnd, nm, indx){
				return google.feeds.getElementsByTagNameNS(xnd, 'http://phobos.apple.com/rss/1.0/modules/itms/', nm)[indx];
			}
			
			
			for ( var i = 0, j = entries.length ; i < j ; i++ ) {
				
				var
				entry = entries[i],
				eNode = entry.xmlNode,
				$eWrap = $('<div>').addClass('entry');
				
				
				var
				caNodes = getNodes(eNode,'coverArt', 0);
				alnkNodes = getNodes(eNode,'albumLink', 0);
				if (caNodes != null) {
					$('<a>')
						.attr('href',alnkNodes.firstChild.nodeValue)
						.append($('<img>').attr('src', caNodes.firstChild.nodeValue))
						.appendTo($eWrap);
				}
				
				var lst = [];
				
				var albmNodes = getNodes(eNode, 'album', 0);
				if (albmNodes != null) {
					var eex = albmNodes.firstChild.nodeValue, regx = /\s?-\s(?:EP|Single)|\s?\(Single\)/;
					
					if(regx.test(eex)){
						eex = '<a>' + eex.replace(regx, '') + '</a><span>' + eex.match(regx) + '</span>';
					}
					else{
						eex = '<a>' + eex + '</a>';
					}
					lst.push('<span class=\'eLabel\'>Album </span>' + eex);
				}
				
				var artstNodes = getNodes(eNode, 'artist', 0);
				if (artstNodes != null) {
					var eex = artstNodes.firstChild.nodeValue;
					if( /Various Artist/.test(eex) ){
						eex = '<span>' + eex + '</span>';
					}
					else{
						eex = '<a>' + eex + '</a>';
					}
					lst.push('<span class=\'eLabel\'>Artist </span>' + eex);
				}
				
				var rghtNodes = getNodes(eNode, 'rights', 0);
				if (rghtNodes != null)
					lst.push('<span class=\'eLabel c-label\'>© </span><span class=\'c-rights\'>' + rghtNodes.firstChild.nodeValue + '</span>');
				
				
				$('<ul>').append('<li>' + lst.join('</li><li>') + '</li>').appendTo($eWrap);
				
				$wrap.append($eWrap.append($('<div>').addClass('clear')));
			}
			
			
			$('#itunes-feed-list').empty().append($wrap.contents()).slideDown();
			$wrap.remove();
		});
	});
}
})(jQuery);





jQuery(function($){
$('#itunes-feed-navi').createiTunesNavi();

var dataKey = $.iTunes.dataKey;
$('a.genre').click(function(e){
	$.makeiTunesRankingList(
		$.data(e.target, dataKey).category,
		$.data(e.target, dataKey).genre);
}).eq(0).trigger('click');



$.setTitle('iTube β', '1.0');
$.showLastModDate();
});
</script>


<style type='text/css'>
body{
	color:#ccc;
}
a{
	color:#aba;
}
a:hover{
	color:#dfd;
}

/* --wrap ----------------------------------- */
#outer-wrap0{}
#outer-wrap1{
	border-right:1px solid #202020;
	border-left:1px solid #202020;	
}
#outer-wrap2{
	border-right:1px solid #4c4c4c;
	border-left:1px solid #4c4c4c;
	background-color:#333;	
}
#outer-wrap3{
	width:960px;
	margin: 0 auto;
}


/* -=-=-=-=-=-=- itunes-feed-wrap -=-=-=-=-=- */
#itunes-feed-wrap{
	width:460px;
	float:right;
}
/* -=-=-=-=-=-=- itunes-feed-list -=-=-=-=-=-=- */
#itunes-feed-list{
	float:left;
	width:280px;
}
#itunes-feed-title{
	color: #cc6699;
}
#itunes-feed-title,
#itunes-feed-list div.entry{
	border-bottom: 1px solid #1a1a1a;
}
#itunes-feed-list div.entry img{
	float:left;
	margin: 5px;
}
#itunes-feed-list div.entry ul{
	font-size:12px;
	line-height:1.2em;
	list-style:none;
	margin-left: 65px;
	padding: 3px 0 5px;
}
#itunes-feed-list div.entry ul li{
	line-height:1em;
}
#itunes-feed-list div.entry ul li span.eLabel{
	color: #708090;
	font-weight: bold;
}
#itunes-feed-list div.entry ul li span.c-label{
	color: #808080;
	line-height:1em;
}
#itunes-feed-list div.entry ul li span.c-rights{
	color: #808080;
	font-size:11px;
	line-height:1em;
}
/* -=-=-=-=-=-=-=- itunes-navi -=-=-=-=-=-=-=- */
#itunes-feed-navi{
	float:right;
}
#itunes-navi-wrap{
	background-color:#4c4c4c;
	border: 1px solid #2a2a2a;
	font-size:14px;
	overflow:hidden;
	padding-top:2px;
	position: relative;
	width:160px;
}

/* -=-=-=-=- itunes content wrapper -=-=-=-=-=- */
#itunes-navi-wrap div.itunes-navi-category-wrap{
	padding:0 2px 2px;
}

/* -=-=-=-=-=-=-=- navi toggle -=-=-=-=-=-=-=- */
#itunes-navi-wrap a.itunes-navi-tgl{
	background-color:#333;
	border: 1px solid #2a2a2a;
	display:block;
	font-weight:bold;
	height:24px;
	line-height:24px;
	text-align:center;
}

#itunes-navi-wrap a.itunes-navi-tgl.current{
	background-color:#4c4c4c;
	border: 1px solid #4c4c4c;
	color:#000;
	cursor:default;
}
#itunes-navi-wrap a.itunes-navi-tgl.current:hover{
	color:#000;
}

/* -=-=-=-=-=-=-=- genre list -=-=-=-=-=-=-=- */
#itunes-navi-wrap ul.itunes-navi-list{
	margin:0;
	list-style:none;
	padding:0 5px 3px;
	text-align:center;
}

#itunes-navi-wrap ul.itunes-navi-list li a{
	display:block;
	/*border-bottom: 1px solid #4c4c4c;*/
	border-left: 6px solid #4c4c4c;
	border-right: 6px solid #4c4c4c;
	/*border-top: 1px solid #4c4c4c;*/
}
#itunes-navi-wrap ul.itunes-navi-list li a:hover{
	background-color:#333333;
	/*border-bottom: 1px solid #2a2a2a;*/
	border-left: 6px solid #2a2a2a;
	border-right: 6px solid #2a2a2a;
	/*border-top: 1px solid #2a2a2a;*/
}
#itunes-navi-wrap ul.itunes-navi-list li a.current{
	background-color:#333333;
	/*border-bottom: 1px solid #2a2a2a;*/
	border-left: 6px solid #2a2a2a;
	border-right: 6px solid #2a2a2a;
	/*border-top: 1px solid #2a2a2a;*/
}

</style>
</head>
<body>
	<div id="header-wrap"><div id="header-inner"><div id="header">
		<h1 id="title" title="Page Title">iTube β</h1>
	</div></div></div>
	<div class="line-outer"><div class="line-inner"></div></div>
	
	<div id="outer-wrap0"><div id="outer-wrap1"><div id="outer-wrap2"><div id="outer-wrap3">
		<div class="clear dummy"></div>
		
		<div id='itunes-feed-wrap'>
			<div id='itunes-feed-list'></div>
			<div id='itunes-feed-navi'></div>
			<div class="clear"></div>
		</div>
		
		<div class="clear dummy"></div>
	</div><!-- outer-wrap3 End -->
	</div><!-- outer-wrap2 End -->
	</div><!-- outer-wrap1 End -->
	</div><!-- outer-wrap0 End -->
	
	<div class="line-outer"><div class="line-inner"></div></div>
	<div id="footer-wrap">
		<div id="footer"><br>
			<small id='footer-page-title' title="page title"></small><br>
			<small>Last Modified:</small><small id="lastmod-date" title="last modified"></small><br>
			<small>© <a href="">humming bird</a>.</small>
			<small title="author">author:y@s</small><br><br>
		</div>
	</div>
</body>
</html>